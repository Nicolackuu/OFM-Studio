"""
DNA Mixer Pro - Advanced Character Generation System
French tags with English translation for API
"""
from typing import Dict, List

# ============================================================================
# DNA CATEGORIES - FRENCH TAGS
# ============================================================================

DNA_IDENTITE = [
    "Française (Parisienne naturelle)",
    "Brésilienne (Bronzage doré)",
    "Russe (Peau porcelaine)",
    "Japonaise (Tokyo moderne)",
    "Italienne (Méditerranéenne)",
    "Scandinave (Ange nordique)",
    "Américaine (Girl next door)",
    "Espagnole (Soleil intense)",
    "Métisse (Caramel goddess)",
    "Coréenne (K-beauty)",
    "Indienne (Bollywood)",
    "Arabe (Désert mystique)",
    "Latine (Feu tropical)",
    "Africaine (Ébène royale)",
    "Mixte Europe-Asie"
]

DNA_VISAGE = [
    "Ovale (Mâchoire définie)",
    "Cœur (Pommettes hautes)",
    "Diamant (Sculpté)",
    "Rond (Douceur)",
    "Carré (Caractère fort)",
    "Triangle (Menton pointu)",
    "Rectangle (Allongé)",
    "Trapèze (Base large)"
]

DNA_YEUX = [
    "Bleu glace (Limbe foncé)",
    "Vert émeraude (Chat)",
    "Noisette miel (Soleil)",
    "Brun noir (Profond)",
    "Gris orage (Rare)",
    "Hétérochromie (Vairons)",
    "Ambre doré",
    "Bleu-vert (Océan)",
    "Marron clair (Caramel)",
    "Violet (Rare génétique)"
]

DNA_CHEVEUX = [
    "Blond miel (Wavy)",
    "Brun chocolat (Lisse)",
    "Roux cuivré (Naturel)",
    "Noir jais (Carré)",
    "Châtain cendré (Balayage)",
    "Blond platine (Long)",
    "Auburn (Ondulé)",
    "Brun caramel (Beach waves)",
    "Noir bleuté (Asiatique)",
    "Blond vénitien",
    "Gris argenté (Prématuré)",
    "Rose gold (Teinté)",
    "Brun doré (Highlights)",
    "Noir corbeau (Brillant)",
    "Châtain foncé (Naturel)"
]

DNA_NEZ_LEVRES = [
    "Nez fin / Lèvres pulpeuses",
    "Nez grec / Lèvres douces",
    "Nez mignon / Lèvres larges",
    "Nez aquilin / Lèvres fines",
    "Nez retroussé / Lèvres moyennes",
    "Nez droit / Lèvres définies",
    "Nez court / Lèvres charnues",
    "Nez long / Lèvres naturelles"
]

DNA_SIGNES = [
    "Grain de beauté (joue gauche)",
    "Fossettes (sourire)",
    "Taches de rousseur (nez)",
    "Cicatrice sourcil (discrète)",
    "Piercing nez (diamant)",
    "Tatouage cou (minimaliste)",
    "Yeux légèrement asymétriques",
    "Lèvre supérieure plus pleine",
    "Dent du bonheur (gap)",
    "Sourcils épais naturels",
    "Cils ultra-longs",
    "Peau parfaite (zéro défaut)",
    "Pores visibles (réaliste)",
    "Rides expression (yeux)",
    "Joues creuses (mannequin)"
]

DNA_STYLE = [
    "Casual chic (Jeans + T-shirt)",
    "Streetwear (Oversized)",
    "Élégant (Robe fluide)",
    "Sportif (Athleisure)",
    "Bohème (Hippie moderne)",
    "Minimaliste (Noir & blanc)",
    "Glamour (Paillettes)",
    "Grunge (Années 90)",
    "Preppy (Collège américain)",
    "Rock (Cuir + clous)",
    "Vintage (Années 60)",
    "Business (Tailleur)",
    "Romantique (Dentelle)",
    "Edgy (Avant-garde)",
    "Naturel (Bohème terre)"
]

# ============================================================================
# TRANSLATION DICTIONARY - FRENCH TO ENGLISH
# ============================================================================

TRANSLATION_DICT = {
    # Identité
    "Française (Parisienne naturelle)": "French Parisian student, naturally stunning, effortless beauty, minimal makeup",
    "Brésilienne (Bronzage doré)": "Brazilian model, golden tan skin, warm undertones, radiant healthy glow",
    "Russe (Peau porcelaine)": "Russian elegant beauty, pale porcelain skin, high cheekbones, striking look",
    "Japonaise (Tokyo moderne)": "Japanese Tokyo fashionista, flawless skin texture, almond eyes, trendy",
    "Italienne (Méditerranéenne)": "Italian brunette, olive skin tone, passionate gaze, mediterranean charm",
    "Scandinave (Ange nordique)": "Swedish angelic beauty, sun-bleached hair, light skin, ethereal",
    "Américaine (Girl next door)": "American girl next door, athletic, healthy flush, bright smile",
    "Espagnole (Soleil intense)": "Spanish beauty, sun-kissed skin, expressive features, dark eyes",
    "Métisse (Caramel goddess)": "Mixed race goddess, glowing caramel skin, unique features, perfect symmetry",
    "Coréenne (K-beauty)": "Korean beauty, glass skin, straight black hair, delicate features",
    "Indienne (Bollywood)": "Indian Bollywood actress, warm brown skin, expressive eyes, elegant",
    "Arabe (Désert mystique)": "Middle Eastern beauty, olive complexion, mysterious gaze, exotic",
    "Latine (Feu tropical)": "Latina beauty, warm skin tone, vibrant energy, passionate",
    "Africaine (Ébène royale)": "African queen, rich dark skin, regal features, striking beauty",
    "Mixte Europe-Asie": "Eurasian mixed heritage, unique blend, striking features, exotic beauty",
    
    # Visage
    "Ovale (Mâchoire définie)": "Symmetrical oval face with sharp defined jawline and elegant chin",
    "Cœur (Pommettes hautes)": "Heart-shaped face, high prominent cheekbones, delicate chin",
    "Diamant (Sculpté)": "Diamond face shape, sculpted hollow cheeks, angular features",
    "Rond (Douceur)": "Soft round face shape, full cheeks, youthful appearance",
    "Carré (Caractère fort)": "Square face shape with strong jawline, intense look",
    "Triangle (Menton pointu)": "Triangle face, narrow forehead, pointed chin",
    "Rectangle (Allongé)": "Rectangle face, elongated features, balanced proportions",
    "Trapèze (Base large)": "Trapezoid face, wider jaw, narrow forehead",
    
    # Yeux
    "Bleu glace (Limbe foncé)": "Piercing ice-blue eyes with dark limbal ring, sharp almond shape",
    "Vert émeraude (Chat)": "Vivid emerald green eyes, upturned cat-eye shape, seductive",
    "Noisette miel (Soleil)": "Warm hazel eyes with golden honey flecks, large round shape",
    "Brun noir (Profond)": "Deep dark chocolate eyes, mysterious, soulful, hooded eyelids",
    "Gris orage (Rare)": "Rare storm-grey eyes, changing with light, melancholic",
    "Hétérochromie (Vairons)": "Heterochromia (left eye blue, right eye hazel), unique",
    "Ambre doré": "Golden amber eyes, warm glow, rare color",
    "Bleu-vert (Océan)": "Blue-green ocean eyes, aquamarine color, mesmerizing",
    "Marron clair (Caramel)": "Light brown caramel eyes, warm and inviting",
    "Violet (Rare génétique)": "Violet eyes, extremely rare genetic trait, stunning",
    
    # Cheveux
    "Blond miel (Wavy)": "Honey blonde hair, long layers, loose natural beach waves",
    "Brun chocolat (Lisse)": "Rich dark chocolate brown hair, waist length, silky straight",
    "Roux cuivré (Naturel)": "Natural copper red hair, voluminous, soft curls",
    "Noir jais (Carré)": "Jet black hair, sharp bob cut (chin length), glossy",
    "Châtain cendré (Balayage)": "Ash brown hair with blonde highlights (balayage), messy bun",
    "Blond platine (Long)": "Platinum blonde hair, extremely long, straight with curtain bangs",
    "Auburn (Ondulé)": "Auburn hair, rich reddish-brown, wavy texture",
    "Brun caramel (Beach waves)": "Caramel brown hair, sun-kissed, beachy waves",
    "Noir bleuté (Asiatique)": "Blue-black hair, Asian straight, glossy shine",
    "Blond vénitien": "Venetian blonde, golden highlights, luxurious",
    "Gris argenté (Prématuré)": "Premature silver grey hair, sophisticated, unique",
    "Rose gold (Teinté)": "Rose gold tinted hair, pastel pink, trendy",
    "Brun doré (Highlights)": "Golden brown hair with natural highlights",
    "Noir corbeau (Brillant)": "Raven black hair, ultra shiny, dramatic",
    "Châtain foncé (Naturel)": "Dark chestnut brown, natural texture",
    
    # Nez/Lèvres
    "Nez fin / Lèvres pulpeuses": "Small straight button nose and naturally full plush lips",
    "Nez grec / Lèvres douces": "Elegant straight Grecian nose and soft balanced rosebud lips",
    "Nez mignon / Lèvres larges": "Slightly upturned cute nose and wide smile, prominent lower lip",
    "Nez aquilin / Lèvres fines": "Aquiline nose with refined thin lips",
    "Nez retroussé / Lèvres moyennes": "Upturned nose with medium balanced lips",
    "Nez droit / Lèvres définies": "Straight nose with well-defined cupid's bow lips",
    "Nez court / Lèvres charnues": "Short nose with full fleshy lips",
    "Nez long / Lèvres naturelles": "Long elegant nose with natural lips",
    
    # Signes distinctifs
    "Grain de beauté (joue gauche)": "Beauty mark on left cheek (Marilyn Monroe style)",
    "Fossettes (sourire)": "Dimples when smiling, charming",
    "Taches de rousseur (nez)": "Freckles across nose and cheeks, natural",
    "Cicatrice sourcil (discrète)": "Small scar through eyebrow, edgy",
    "Piercing nez (diamant)": "Nose piercing with diamond stud, delicate",
    "Tatouage cou (minimaliste)": "Minimalist neck tattoo, artistic",
    "Yeux légèrement asymétriques": "Slightly asymmetric eyes, unique charm",
    "Lèvre supérieure plus pleine": "Fuller upper lip, distinctive",
    "Dent du bonheur (gap)": "Tooth gap (diastema), endearing",
    "Sourcils épais naturels": "Thick natural eyebrows, bold",
    "Cils ultra-longs": "Ultra-long natural eyelashes, dramatic",
    "Peau parfaite (zéro défaut)": "Flawless perfect skin, no imperfections",
    "Pores visibles (réaliste)": "Visible pores, realistic human skin texture",
    "Rides expression (yeux)": "Expression lines around eyes, mature beauty",
    "Joues creuses (mannequin)": "Hollow cheeks, high fashion model look"
}

# ============================================================================
# DNA MIXER CLASS
# ============================================================================

class DNAMixer:
    """Advanced DNA mixing system with French tags"""
    
    def __init__(self):
        self.selected_tags = {
            "identite": [],
            "visage": [],
            "yeux": [],
            "cheveux": [],
            "nez_levres": [],
            "signes": [],
            "style": []
        }
        self.custom_instructions = ""
        self.age = 22
    
    def set_tags(self, category: str, tags: List[str]):
        """Set tags for a category"""
        if category in self.selected_tags:
            self.selected_tags[category] = tags
    
    def set_custom_instructions(self, instructions: str):
        """Set custom instructions"""
        self.custom_instructions = instructions
    
    def set_age(self, age: int):
        """Set character age"""
        self.age = age
    
    def generate_random(self):
        """Generate random DNA profile by selecting random tags from each category"""
        import random
        
        # Randomly select one tag from each category
        self.selected_tags = {
            "identite": [random.choice(DNA_IDENTITE)],
            "visage": [random.choice(DNA_VISAGE)],
            "yeux": [random.choice(DNA_YEUX)],
            "cheveux": [random.choice(DNA_CHEVEUX)],
            "nez_levres": [random.choice(DNA_NEZ_LEVRES)],
            "signes": [random.choice(DNA_SIGNES)],
            "style": [random.choice(DNA_STYLE)]
        }
        
        # Random age between 20-28
        self.age = random.randint(20, 28)
        
        # Clear custom instructions
        self.custom_instructions = ""
    
    def translate_tags(self) -> Dict[str, List[str]]:
        """Translate French tags to English"""
        translated = {}
        for category, tags in self.selected_tags.items():
            translated[category] = [
                TRANSLATION_DICT.get(tag, tag) for tag in tags
            ]
        return translated
    
    def build_master_prompt(self) -> str:
        """Build master prompt from selected tags"""
        translated = self.translate_tags()
        
        # Build prompt sections
        sections = []
        
        # Identity
        if translated["identite"]:
            sections.append(f"IDENTITY: {', '.join(translated['identite'])}")
        
        # Face
        if translated["visage"]:
            sections.append(f"FACE SHAPE: {', '.join(translated['visage'])}")
        
        # Eyes
        if translated["yeux"]:
            sections.append(f"EYES: {', '.join(translated['yeux'])}")
        
        # Hair
        if translated["cheveux"]:
            sections.append(f"HAIR: {', '.join(translated['cheveux'])}")
        
        # Nose/Lips
        if translated["nez_levres"]:
            sections.append(f"NOSE & LIPS: {', '.join(translated['nez_levres'])}")
        
        # Distinctive features
        if translated["signes"]:
            sections.append(f"DISTINCTIVE FEATURES: {', '.join(translated['signes'])}")
        
        # Style
        if translated["style"]:
            sections.append(f"STYLE: {', '.join(translated['style'])}")
        
        # Master prompt
        prompt = f"""### PROFESSIONAL PORTRAIT STUDY: PHASE 1 (FOUNDATION) ###
OBJECTIVE: Create a high-resolution photographic triptych to establish primary facial structure.
Focus on maximum detail clarity while maintaining extreme attractiveness.

Layout: 3 large frames side-by-side.
Subject: Fictional female model, {self.age} years old.

FRAME 1 (LEFT): Strict 90-degree left profile.
FRAME 2 (CENTER): Dead-center frontal headshot. Neutral expression, symmetrical.
FRAME 3 (RIGHT): Three-quarter view (45 degrees right).

PHOTOREALISM & TEXTURE PROTOCOL:
- Aesthetic: High-end editorial photography, raw but flattering lighting.
- DETAILS: Ultra-sharp focus on iris patterns, natural skin texture with visible pores.
- RESTRICTIONS: NO plastic smoothing, NO AI-blur. Skin must look human.

MODEL SPECIFICS:
{chr(10).join(sections)}

{self.custom_instructions if self.custom_instructions else ''}

TECHNICAL REQUIREMENTS:
- Resolution: 4K minimum
- Lighting: Natural, soft shadows
- Background: Neutral grey or white
- Expression: Neutral, professional
"""
        
        return prompt.strip()
    
    def is_complete(self) -> bool:
        """Check if DNA configuration is complete"""
        required = ["identite", "visage", "yeux", "cheveux", "nez_levres"]
        for cat in required:
            if not self.selected_tags[cat]:
                return False
        return True
    
    def get_summary(self) -> str:
        """Get DNA summary in French"""
        parts = []
        for category, tags in self.selected_tags.items():
            if tags:
                parts.append(f"{category.upper()}: {', '.join(tags)}")
        return "\n".join(parts) if parts else "Aucune configuration"
